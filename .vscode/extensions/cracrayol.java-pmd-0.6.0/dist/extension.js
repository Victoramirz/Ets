module.exports=function(t){var e={};function s(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e){t.exports=require("vscode")},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.stripQuotes=e.dirExists=e.fileExists=e.getRootWorkspacePath=void 0;const n=s(8),i=s(0);e.getRootWorkspacePath=function(){const t=i.workspace;return t&&t.workspaceFolders&&t.workspaceFolders.length>0?i.workspace.workspaceFolders[0].uri.fsPath:""},e.fileExists=function(t){try{return n.statSync(t).isFile()}catch(t){return!1}},e.dirExists=function(t){try{return n.statSync(t).isDirectory()}catch(t){return!1}},e.stripQuotes=function(t){return t.substr(1,t.length-2)}},function(t,e){t.exports=require("path")},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AppStatus=void 0;const n=s(0);class i{constructor(){this._appStatus=n.window.createStatusBarItem(n.StatusBarAlignment.Right,5),this._appStatus.text=i._okMsg,this._appStatus.command=i.DEFAULT_COMMAND,this._appStatus.show();n.window.activeTextEditor?(this._appStatus.show(),this._isHidden=!1):(this._appStatus.hide(),this._isHidden=!0)}static get _thinkingMsg(){return`${i._appName} ${i.APP_THINKING_ICON}`}static get _errorsMsg(){return`${i._appName} ${i.APP_HAS_ERR_ICON}`}static get _okMsg(){return`${i._appName} ${i.APP_IS_OK_ICON}`}static setAppName(t){i._appName=i._appName||t}static getInstance(){return null==i._instance&&(i._instance=i.create()),i._instance}static create(){return new i}show(){this._isHidden&&(this._appStatus.text=i._okMsg,this._appStatus.show(),this._isHidden=!1)}hide(){this._appStatus.hide(),this._isHidden=!0}thinking(){this._appStatus.text=i._thinkingMsg}errors(){this._appStatus.text=i._errorsMsg}ok(){this._appStatus.text=i._okMsg}dispose(){this._appStatus.dispose()}}e.AppStatus=i,i.DEFAULT_COMMAND="workbench.actions.view.problems",i.APP_THINKING_ICON="$(clock)",i.APP_IS_OK_ICON="$(check)",i.APP_HAS_ERR_ICON="$(alert)",i._instance=null},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=e.JavaPmd=void 0;const n=s(0),i=s(5);Object.defineProperty(e,"JavaPmd",{enumerable:!0,get:function(){return i.JavaPmd}});const a=s(9),o=s(3),r=s(10),u=s(1),c=["java"],h=t=>0<=c.indexOf(t),l=n.languages.createDiagnosticCollection("java-pmd"),d=n.window.createOutputChannel("Java PMD");e.activate=function(t){const e=new a.Config(t),s=new i.JavaPmd(d,e);o.AppStatus.setAppName("Java PMD"),o.AppStatus.getInstance().ok(),t.subscriptions.push(n.commands.registerCommand("java-pmd.clearProblems",()=>{l.clear()})),t.subscriptions.push(n.commands.registerCommand("java-pmd.runWorkspace",()=>{n.window.withProgress({location:n.ProgressLocation.Notification,title:"Running Static Analysis on workspace",cancellable:!0},(t,e)=>(t.report({increment:0}),s.run(u.getRootWorkspacePath(),l,t,e)))})),t.subscriptions.push(n.commands.registerCommand("java-pmd.runFile",t=>{t||(t=n.window.activeTextEditor.document.uri),t instanceof n.Uri?"file"==t.scheme?s.run(t.fsPath,l):d.append("Not analysing "+t.path+": scheme not managed."):s.run(t,l)})),e.runOnFileSave&&n.workspace.onDidSaveTextDocument(t=>{if(h(t.languageId))return n.commands.executeCommand("java-pmd.runFile",t.fileName)}),e.runOnFileChange&&n.workspace.onDidChangeTextDocument(r.debounce(t=>{const e=t.document;if(h(e.languageId))return n.commands.executeCommand("java-pmd.runFile",e.fileName)},e.onFileChangeDebounce)),e.runOnFileOpen&&n.window.onDidChangeActiveTextEditor(t=>{if(h(t.document.languageId))return n.commands.executeCommand("java-pmd.runFile",t.document.fileName,!0)}),n.workspace.onDidChangeConfiguration(t=>{if(t.affectsConfiguration("javaPMD"))return e.init(),s.updateConfiguration(e)}),t.subscriptions.push(n.window.onDidChangeVisibleTextEditors(t=>{t.some(t=>t.document&&h(t.document.languageId))?o.AppStatus.getInstance().show():o.AppStatus.getInstance().hide()}))},e.deactivate=function(){}},function(t,e,s){"use strict";var n=this&&this.__awaiter||function(t,e,s,n){return new(s||(s=Promise))((function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function r(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}u((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.JavaPmd=void 0;const i=s(0),a=s(6),o=s(2),r=s(3),u=s(7),c=s(1),h="win32"===u.platform()?";":":";e.JavaPmd=class{constructor(t,e){this.config=e,this.rulesets=this.getValidRulesetPaths(e.rulesets),this.outputChannel=t}updateConfiguration(t){this.config=t,this.rulesets=this.getValidRulesetPaths(t.rulesets)}run(t,e,s,a){return n(this,void 0,void 0,(function*(){this.outputChannel.appendLine("Analyzing "+t),r.AppStatus.getInstance().thinking();let n=!1;if(a&&a.onCancellationRequested(()=>{n=!0}),this.checkPmdPath()&&this.hasAtLeastOneValidRuleset())try{const o=yield this.executeCmd(t,a),u=this.parseProblems(o);if(u.size>0){r.AppStatus.getInstance().errors(),s&&s.report({message:`Processing ${u.size} file(s)`});const t=1/u.size*100;for(const[a,o]of u){if(n)return;s&&s.report({increment:t});try{const t=i.Uri.file(a),s=yield i.workspace.openTextDocument(t);o.forEach(t=>{const e=s.lineAt(t.range.start.line);t.range=new i.Range(new i.Position(e.range.start.line,e.firstNonWhitespaceCharacterIndex),e.range.end)}),e.set(t,o)}catch(t){this.outputChannel.appendLine(t)}}}else{const s=i.Uri.file(t);e.delete(s),r.AppStatus.getInstance().ok()}}catch(t){r.AppStatus.getInstance().errors(),i.window.showErrorMessage("Static Analysis Failed. Error Details: "+t)}}))}getRulesets(){return this.rulesets}getValidRulesetPaths(t){return t.filter(t=>this.checkRulesetPath(t))}hasAtLeastOneValidRuleset(){return!!this.rulesets.length||(i.window.showErrorMessage('No valid Ruleset paths found in "javaPMD.rulesets". Ensure configuration correct or change back to the default.'),!1)}executeCmd(t,e){return n(this,void 0,void 0,(function*(){const{workspaceRootPath:s,enableCache:n,pmdBinPath:i,additionalClassPaths:r,showStdOut:u,showStdErr:c,commandBufferSize:l,showErrors:d}=this.config,p=s+"/.pmdCache",f=this.rulesets.join(","),g=`-f json ${n?`--cache "${p}"`:"--no-cache"} ${`-d "${t}"`} ${`-R "${f}"`}`,m=[o.join(i,"lib","*"),o.join(s,"*"),...r].join(h),P=`${this.config.jrePath?o.join(this.config.jrePath,"bin","java"):"java"} -cp "${m}" net.sourceforge.pmd.PMD ${g}`;u&&this.outputChannel.appendLine("PMD Command: "+P);const w=a.exec(P,{maxBuffer:1024*Math.max(l,1)*1024});e&&e.onCancellationRequested(()=>{w.kill()});let _="";return new Promise((t,e)=>{w.addListener("error",t=>{d&&this.outputChannel.appendLine("error:"+t),e(t)}),w.addListener("exit",s=>{0!==s&&4!==s&&(this.outputChannel.appendLine("Failed Exit Code: "+s),_||e('PMD Command Failed!  Enable "Show StdErr" setting for more info.')),t(_)}),w.stdout.on("data",t=>{u&&this.outputChannel.appendLine("stdout:"+t),_+=t}),w.stderr.on("data",t=>{c&&this.outputChannel.appendLine("stderr:"+t)})})}))}parseProblems(t){const e=JSON.parse(t),s=new Map;let n=0;for(const t of e.files)for(const e of t.violations){const i=this.createDiagnostic(e);n++,s.has(t.filename)?s.get(t.filename).push(i):s.set(t.filename,[i])}return this.outputChannel.appendLine(n+" issue(s) found"),s}createDiagnostic(t){const{priorityErrorThreshold:e,priorityWarnThreshold:s}=this.config,n=t.beginline-1,a=t.externalInfoUrl,o=`${t.description} (rule: ${t.ruleset}-${t.rule})`,r=t.priority;let u;u=r<=e?i.DiagnosticSeverity.Error:r<=s?i.DiagnosticSeverity.Warning:i.DiagnosticSeverity.Information;const c=new i.Diagnostic(new i.Range(new i.Position(n,0),new i.Position(n,100)),o,u);return c.code={target:i.Uri.parse(a),value:t.rule},c.source="java pmd",c}checkPmdPath(){const{pmdBinPath:t}=this.config;return!!c.dirExists(t)||(this.outputChannel.appendLine(t),i.window.showErrorMessage("PMD Path Does not reference a valid directory.  Please update or clear"),!1)}checkRulesetPath(t){return!!c.fileExists(t)||(i.window.showErrorMessage(`No Ruleset not found at ${t}. Ensure configuration correct or change back to the default.`),!1)}}},function(t,e){t.exports=require("child_process")},function(t,e){t.exports=require("os")},function(t,e){t.exports=require("fs")},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0;const n=s(0),i=s(2),a=s(1);e.Config=class{constructor(t){t?(this._ctx=t,this.init()):console.warn("VSCode JavaPMD missing configuration")}init(){const t=n.workspace.getConfiguration("javaPMD");this._rulesetPath=t.get("rulesetPath"),this.workspaceRootPath=a.getRootWorkspacePath(),this.rulesets=t.get("rulesets"),this.pmdBinPath=t.get("pmdBinPath"),this.priorityErrorThreshold=t.get("priorityErrorThreshold"),this.priorityWarnThreshold=t.get("priorityWarnThreshold"),this.runOnFileOpen=t.get("runOnFileOpen"),this.runOnFileSave=t.get("runOnFileSave"),this.runOnFileChange=t.get("runOnFileChange"),this.onFileChangeDebounce=t.get("onFileChangeDebounce"),this.showErrors=t.get("showErrors"),this.showStdOut=t.get("showStdOut"),this.showStdErr=t.get("showStdErr"),this.enableCache=t.get("enableCache"),this.additionalClassPaths=t.get("additionalClassPaths"),this.commandBufferSize=t.get("commandBufferSize"),this.jrePath=t.get("jrePath"),this.resolvePaths()}resolvePaths(){this.rulesets||(this.rulesets=[]),this.rulesets.length&&(this.rulesets=this.rulesets.map(t=>{let e=t;return"default"===e.toLowerCase()?e=this._ctx.asAbsolutePath(i.join("rulesets","quickstart.xml")):!i.isAbsolute(e)&&this.workspaceRootPath&&(e=i.join(this.workspaceRootPath,e)),e})),this._rulesetPath||this.rulesets.length?this._rulesetPath&&!i.isAbsolute(this._rulesetPath)&&this.workspaceRootPath&&(this._rulesetPath=i.join(this.workspaceRootPath,this._rulesetPath)):this._rulesetPath=this._ctx.asAbsolutePath(i.join("rulesets","quickstart.xml")),this._rulesetPath&&this.rulesets.push(this._rulesetPath),this.pmdBinPath||(this.pmdBinPath=this._ctx.asAbsolutePath(i.join("bin","pmd"))),this.pmdBinPath&&!i.isAbsolute(this.pmdBinPath)&&this.workspaceRootPath&&(this.pmdBinPath=i.join(this.workspaceRootPath,this.pmdBinPath)),this.jrePath&&!i.isAbsolute(this.jrePath)&&this.workspaceRootPath&&(this.jrePath=i.join(this.workspaceRootPath,this.jrePath)),this.additionalClassPaths||(this.additionalClassPaths=[]),this.additionalClassPaths.length&&(this.additionalClassPaths=this.additionalClassPaths.map(t=>{let e=t;return!i.isAbsolute(t)&&this.workspaceRootPath&&(e=i.join(this.workspaceRootPath,t)),e}))}}},function(t,e){function s(t,e,s){var n,i,a,o,r;function u(){var c=Date.now()-o;c<e&&c>=0?n=setTimeout(u,e-c):(n=null,s||(r=t.apply(a,i),a=i=null))}null==e&&(e=100);var c=function(){a=this,i=arguments,o=Date.now();var c=s&&!n;return n||(n=setTimeout(u,e)),c&&(r=t.apply(a,i),a=i=null),r};return c.clear=function(){n&&(clearTimeout(n),n=null)},c.flush=function(){n&&(r=t.apply(a,i),a=i=null,clearTimeout(n),n=null)},c}s.debounce=s,t.exports=s}]);
//# sourceMappingURL=extension.js.map